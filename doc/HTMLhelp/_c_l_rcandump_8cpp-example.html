<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>Kvaser CANLIB: CLRcandump.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="kvaser.gif"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kvaser CANLIB: Welcome to Kvaser CANLIB!
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CLRcandump.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">// CLRcandump.cpp : main project file.</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;stdafx.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;stdlib.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span>System;</div><div class="line"><span class="keyword">using namespace </span>System::IO;</div><div class="line"><span class="keyword">using namespace </span>canlibCLSNET;</div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Global variables for the command-line options.</span></div><div class="line"><span class="comment">// </span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span>  quiet = 0;                      <span class="comment">// Defines the verbosity.</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> logToFile = <span class="keyword">false</span>;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> allowVirtual = <span class="keyword">false</span>;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> msgCount = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> overRuns = 0;</div><div class="line"><span class="keyword">static</span> __int64 timeOffset = 0;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> DisplayHelp(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    Console::Write(<span class="stringliteral">&quot;\nCANLIB Dump Program\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;(Part of the CANLIB SDK from KVASER AB - http://www.kvaser.se)\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;This is a sample program that just dumps all incoming messages to the screen\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;or a file.\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;\nUsage: candump [flags] [filename]\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;   -X          Listen to CAN channel number X.\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;   -B&lt;value&gt;   Set the bitrate. Value is any of 1000,500,250,125.\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;               Default bitrate is 125 kbit/s.\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;   -h          Print this help text.\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;   -q          Be more quiet than usual.\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;   -v          Allow use of virtual channel.\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;\nIf no filename is specified, standard output is used.\n\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;The following keys can be used during logging:\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;   ESC         Stop logging.\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;   Q           Be more quiet.\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;   q           Be less quiet.\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;\nExample:\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;candump -B250 -0 logfile.log\n&quot;</span>);</div><div class="line">    Console::Write(<span class="stringliteral">&quot;   would set CAN channel 0 to 250 kbit/s and log to logfile.log\n&quot;</span>);</div><div class="line">    Environment::Exit(0);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ReportError(String^ funcName, <a name="a0"></a><a class="code" href="canstat_8h.html#a52b5e5c71832b0bd3c6a5b1fd48583e7">Canlib::canStatus</a> status)</div><div class="line">{</div><div class="line">    IO::TextWriter^ errOutput = Console::Error;</div><div class="line">    String^ errString;</div><div class="line">    <a name="a1"></a><a class="code" href="group___general.html#ga01a7a415c95c579750bcdd95a1d245c4">Canlib::canGetErrorText</a>(status, errString);</div><div class="line">    errOutput-&gt;WriteLine(<span class="stringliteral">&quot;{0}: failed, status = {1} ({2})&quot;</span>, funcName, status, errString);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> PrepareChannel(<span class="keywordtype">int</span> channel, <span class="keywordtype">int</span> bitrate)</div><div class="line">{</div><div class="line">    <a class="code" href="canstat_8h.html#a52b5e5c71832b0bd3c6a5b1fd48583e7">Canlib::canStatus</a> retStatus;</div><div class="line"></div><div class="line">    <span class="comment">// initialize the API library</span></div><div class="line">    <a name="a2"></a><a class="code" href="group___general.html#gaff1ec1d3416d3bdd56336a7b9ac008b1">Canlib::canInitializeLibrary</a>();</div><div class="line"></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="comment">// First, open a handle to the CAN circuit. Specifying</span></div><div class="line">    <span class="comment">// canOPEN_EXCLUSIVE ensures we get a circuit that noone else</span></div><div class="line">    <span class="comment">// is using.</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="keywordtype">int</span> flags = <a name="a3"></a><a class="code" href="canlib_8h.html#afacd9e186d273d0dc24956ea0d433822">Canlib::canOPEN_EXCLUSIVE</a> | ((allowVirtual) ? <a name="a4"></a><a class="code" href="canlib_8h.html#a8e4ead14e67e49e27674c706e0d88f23">Canlib::canOPEN_ACCEPT_VIRTUAL</a> : 0);</div><div class="line">    <span class="keywordtype">int</span> hnd = <a name="a5"></a><a class="code" href="group___c_a_n.html#gaf4e7a8053f90cf57a3658e485b1aaefa">Canlib::canOpenChannel</a>(channel, flags);</div><div class="line">    <span class="keywordflow">if</span> (hnd &lt; 0) {</div><div class="line">        retStatus = (<a class="code" href="canstat_8h.html#a52b5e5c71832b0bd3c6a5b1fd48583e7">Canlib::canStatus</a>)hnd;</div><div class="line">        ReportError(<span class="stringliteral">&quot;canOpenChannel&quot;</span>, retStatus);</div><div class="line">        Environment::Exit(1);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="comment">// Using our new shiny handle, we specify the baud rate</span></div><div class="line">    <span class="comment">// using one of the convenient canBITRATE_xxx constants.</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="comment">// The bit layout is in depth discussed in most CAN</span></div><div class="line">    <span class="comment">// controller data sheets, and on the web at</span></div><div class="line">    <span class="comment">// http://www.kvaser.se.</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="keywordflow">if</span> ((retStatus = <a name="a6"></a><a class="code" href="group___c_a_n.html#ga14575bf23bf18918c0286e072e3c11cc">Canlib::canSetBusParams</a>(hnd, bitrate, 0, 0, 0, 0, 0)) != </div><div class="line">         <a name="a7"></a><a class="code" href="canstat_8h.html#a52b5e5c71832b0bd3c6a5b1fd48583e7a49743d0d438957118b9c6af2e831b209">Canlib::canStatus::canOK</a>) {</div><div class="line">        ReportError(<span class="stringliteral">&quot;canSetBusParams&quot;</span>, retStatus);</div><div class="line">        <a name="a8"></a><a class="code" href="group___c_a_n.html#ga56459e39593096dac3a6723493f5e898">Canlib::canClose</a>(hnd);</div><div class="line">        Environment::Exit(1);</div><div class="line">    }</div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="comment">// Then we start the ball rolling.</span></div><div class="line">    <span class="comment">// </span></div><div class="line">    <span class="keywordflow">if</span> ((retStatus = <a name="a9"></a><a class="code" href="group___c_a_n.html#gab84fce54d4b2c57df9681d452c6319c4">Canlib::canBusOn</a>(hnd)) != <a class="code" href="canstat_8h.html#a52b5e5c71832b0bd3c6a5b1fd48583e7a49743d0d438957118b9c6af2e831b209">Canlib::canStatus::canOK</a>) {</div><div class="line">        ReportError(<span class="stringliteral">&quot;canBusOn&quot;</span>, retStatus);</div><div class="line">        <a class="code" href="group___c_a_n.html#ga56459e39593096dac3a6723493f5e898">Canlib::canClose</a>(hnd);</div><div class="line">        Environment::Exit(1);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Return the handle; our caller will need it for</span></div><div class="line">    <span class="comment">// further exercising the CAN controller.</span></div><div class="line">    <span class="keywordflow">return</span> hnd;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> DisplayLeadIn(<span class="keywordtype">int</span> handle)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (quiet == 0) {</div><div class="line">        <span class="keyword">using namespace </span>System::Globalization;</div><div class="line">        DateTime dt = DateTime::Now;</div><div class="line">        <span class="comment">// setup our timer offset</span></div><div class="line">        timeOffset = <a name="a10"></a><a class="code" href="group___c_a_n.html#ga75e328cd3f597881286e746d978e4b7b">Canlib::canReadTimer</a>(handle);</div><div class="line"></div><div class="line">        Console::WriteLine(<span class="stringliteral">&quot;; Logging started at {0}&quot;</span>, dt.ToString(<span class="stringliteral">&quot;U&quot;</span>, DateTimeFormatInfo::InvariantInfo));</div><div class="line">        Console::WriteLine(<span class="stringliteral">&quot;; (x = Extended Id, R = Remote Frame, o = Overrun, N = NERR)&quot;</span>);</div><div class="line">        Console::WriteLine(<span class="stringliteral">&quot;;  Ident xRoN DLC  Data 0.....................7        Time&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keywordtype">void</span> DisplaySummary(<span class="keywordtype">int</span> handle)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (quiet == 0) {</div><div class="line">        <span class="keyword">using namespace </span>System::Globalization;</div><div class="line">        DateTime dt = DateTime::Now;</div><div class="line">        Console::WriteLine(<span class="stringliteral">&quot;; Logging ended at {0}&quot;</span>, dt.ToString(<span class="stringliteral">&quot;U&quot;</span>, DateTimeFormatInfo::InvariantInfo));</div><div class="line">        Console::WriteLine(<span class="stringliteral">&quot;; {0} messages received.&quot;</span>, msgCount);</div><div class="line">        Console::WriteLine(<span class="stringliteral">&quot;; {0} overrun conditions detected.&quot;</span>, overRuns);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> EmptyReceiveBuffer(<span class="keywordtype">int</span> handle)</div><div class="line">{</div><div class="line">    <a class="code" href="canstat_8h.html#a52b5e5c71832b0bd3c6a5b1fd48583e7">Canlib::canStatus</a> status;</div><div class="line">    <span class="keywordtype">int</span> id, dlc, flags;</div><div class="line">    array &lt;unsigned char, 1&gt; ^msg = <span class="keyword">gcnew</span> array&lt;unsigned char&gt;(8);</div><div class="line">    __int64 time;</div><div class="line">    __int64 adjTime, timeFrac, timeInt;</div><div class="line">    <span class="keywordtype">int</span> i;</div><div class="line"></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="comment">// Read a message.</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="keywordflow">while</span> ((status = <a name="a11"></a><a class="code" href="group___c_a_n.html#ga46e62517c7a4bcf7d5f96aa7d9f56684">Canlib::canRead</a>(handle, <span class="keywordtype">id</span>, msg, dlc, flags, time)) == <a class="code" href="canstat_8h.html#a52b5e5c71832b0bd3c6a5b1fd48583e7a49743d0d438957118b9c6af2e831b209">Canlib::canStatus::canOK</a>) {</div><div class="line">        <span class="keywordflow">if</span> (quiet &lt;= 1) {</div><div class="line">            <span class="keywordflow">if</span> ((flags &amp; <a name="a12"></a><a class="code" href="canstat_8h.html#ade1b8ed815a4bc6ada6ec666e48e9cf8">Canlib::canMSG_ERROR_FRAME</a>) == 0) {</div><div class="line">                <span class="comment">// A message real message so print identifier and flags.</span></div><div class="line">                Console::Write(<span class="stringliteral">&quot;{0:X8} {1}{2}{3}{4}  {5:G2}        &quot;</span>,</div><div class="line">                               <span class="keywordtype">id</span>,</div><div class="line">                               (flags &amp; <a name="a13"></a><a class="code" href="canstat_8h.html#ade936f23b4b303d64187b4c6589c9c10">Canlib::canMSG_EXT</a>)        ? <span class="stringliteral">&quot;x&quot;</span> : <span class="stringliteral">&quot; &quot;</span>,</div><div class="line">                               (flags &amp; <a name="a14"></a><a class="code" href="canstat_8h.html#a687df04559a9995e0bec503655454eb3">Canlib::canMSG_RTR</a>)        ? <span class="stringliteral">&quot;R&quot;</span> : <span class="stringliteral">&quot; &quot;</span>,</div><div class="line">                               (flags &amp; <a name="a15"></a><a class="code" href="canstat_8h.html#adf0d578c7b25ede29a9733da44f08ab3">Canlib::canMSGERR_OVERRUN</a>) ? <span class="stringliteral">&quot;o&quot;</span> : <span class="stringliteral">&quot; &quot;</span>,</div><div class="line">                               (flags &amp; <a name="a16"></a><a class="code" href="canstat_8h.html#a1f53f2fdeeb263cd2bf5d374e1dd59a2">Canlib::canMSG_NERR</a>)       ? <span class="stringliteral">&quot;N&quot;</span> : <span class="stringliteral">&quot; &quot;</span>, <span class="comment">// TJA 1053/1054 transceivers only</span></div><div class="line">                               dlc);</div><div class="line">                <span class="comment">// Print the data bytes, but not for Remote Frames.</span></div><div class="line">                <span class="comment">// Print at most 8 bytes - the DLC might be larger</span></div><div class="line">                <span class="comment">// but there are never more than 8 bytes in a</span></div><div class="line">                <span class="comment">// message.</span></div><div class="line">                <span class="keywordflow">if</span> (dlc &gt; 8) dlc = 8;</div><div class="line">                <span class="keywordflow">if</span> ((flags &amp; Canlib::canMSG_RTR) == 0) {</div><div class="line">                    <span class="keywordflow">for</span> (i = 0; i &lt; dlc; i++) Console::Write(<span class="stringliteral">&quot;{0:X2} &quot;</span>, msg[i]);</div><div class="line">                    <span class="keywordflow">for</span> (; i &lt; 8; i++) Console::Write(<span class="stringliteral">&quot;   &quot;</span>);</div><div class="line">                } </div><div class="line">                <span class="keywordflow">else</span> {</div><div class="line">                    Console::Write(<span class="stringliteral">&quot;                        &quot;</span>);</div><div class="line">                }</div><div class="line">                msgCount++;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> {</div><div class="line">                <span class="comment">// An error frame.</span></div><div class="line">                <span class="comment">// CANLIB will set the id to something controller</span></div><div class="line">                <span class="comment">// dependent.</span></div><div class="line">                Console::Write(<span class="stringliteral">&quot;  Error Frames                                  &quot;</span>);</div><div class="line">            }</div><div class="line">            </div><div class="line"></div><div class="line">            <span class="comment">// Print the time stamp, formatted as seconds.</span></div><div class="line">            adjTime = time - timeOffset;</div><div class="line">            <span class="keywordflow">if</span> (adjTime &lt; 0) {</div><div class="line">                <span class="comment">// negative values may occur due to time between BusOn call and ReadTimer call.</span></div><div class="line">                timeFrac = (-adjTime) % 1000;</div><div class="line">                timeInt  = (-adjTime) / 1000;</div><div class="line">                Console::WriteLine(<span class="stringliteral">&quot;  -{0,5}.{1:D3}&quot;</span>, timeInt, timeFrac);</div><div class="line">            } </div><div class="line">            <span class="keywordflow">else</span> {</div><div class="line">                timeFrac = adjTime % 1000;</div><div class="line">                timeInt  = adjTime / 1000;</div><div class="line">                Console::WriteLine(<span class="stringliteral">&quot;  {0,6}.{1:D3}&quot;</span>, timeInt, timeFrac);</div><div class="line">            }</div><div class="line">            </div><div class="line">            <span class="comment">// Keep some statistics.</span></div><div class="line">            <span class="keywordflow">if</span> (flags &amp; <a class="code" href="canstat_8h.html#adf0d578c7b25ede29a9733da44f08ab3">Canlib::canMSGERR_OVERRUN</a>) overRuns++;</div><div class="line">        }</div><div class="line">        <span class="comment">//</span></div><div class="line">        <span class="comment">// When there are no more messages in the queue,</span></div><div class="line">        <span class="comment">// stat will be equal to canERR_NOMSG.</span></div><div class="line">        <span class="comment">//</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (status != <a name="a17"></a><a class="code" href="canstat_8h.html#a52b5e5c71832b0bd3c6a5b1fd48583e7a734089f351bc421c230bf8b6cd9b1e8e">Canlib::canStatus::canERR_NOMSG</a>) {</div><div class="line">        ReportError(<span class="stringliteral">&quot;canRead&quot;</span>, status);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> RecordMessages(<span class="keywordtype">int</span> handle)</div><div class="line">{</div><div class="line">    <span class="keywordtype">bool</span> finished = <span class="keyword">false</span>;</div><div class="line">    IO::TextWriter^ errOutput = Console::Error;</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (!finished) {</div><div class="line">        <span class="keywordflow">while</span> (!Console::KeyAvailable) {</div><div class="line">            EmptyReceiveBuffer(handle);</div><div class="line">            Threading::Thread::Sleep(50);</div><div class="line">        }</div><div class="line"></div><div class="line">        ConsoleKeyInfo cki;</div><div class="line">        cki = Console::ReadKey(<span class="keyword">true</span>);</div><div class="line">        <span class="keywordflow">switch</span> (cki.Key) {</div><div class="line">            <span class="keywordflow">case</span> ConsoleKey::Escape:</div><div class="line">                finished = <span class="keyword">true</span>;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> ConsoleKey::Q:</div><div class="line">                <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(cki.Modifiers &amp; ConsoleModifiers::Shift)) {</div><div class="line">                    <span class="keywordflow">if</span> (quiet &lt; 5) quiet++;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> {</div><div class="line">                    <span class="keywordflow">if</span> (quiet &gt; 0) quiet--;</div><div class="line">                }</div><div class="line">                errOutput-&gt;WriteLine(<span class="stringliteral">&quot;New quiet level = {0}&quot;</span>, quiet);                </div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(array&lt;System::String ^&gt; ^args)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span>  bitrate = <a name="a18"></a><a class="code" href="canlib_8h.html#a29a9aafde6e861b4fffb72ad124aeed1">Canlib::canBITRATE_125K</a>; <span class="comment">// Selected bit rate.</span></div><div class="line">    <span class="keywordtype">int</span>  channel = 0;                       <span class="comment">// Channel #</span></div><div class="line">    String^ logFileName = <span class="stringliteral">&quot;&quot;</span>;               <span class="comment">// Name of log file</span></div><div class="line">    IO::StreamWriter^ filePtr = <span class="keyword">nullptr</span>;</div><div class="line">    IO::TextWriter^ stdOutput = Console::Out;</div><div class="line">    IO::TextWriter^ errOutput = Console::Error;</div><div class="line"></div><div class="line">    <span class="comment">// Determine the command line arguements.</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; args-&gt;Length; i++) {</div><div class="line">        <span class="keywordflow">if</span> (args[i][0] != <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line">            logFileName = String::Copy(args[i]);</div><div class="line">            <span class="keywordflow">try</span></div><div class="line">            {</div><div class="line">                filePtr = File::CreateText(logFileName);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">catch</span> (IO::IOException^ e) </div><div class="line">            {</div><div class="line">                errOutput-&gt;WriteLine(e-&gt;Message);</div><div class="line">                DisplayHelp();</div><div class="line">            }</div><div class="line">            logToFile = <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i][1] == <span class="charliteral">&#39;h&#39;</span>) {</div><div class="line">            <span class="comment">// needs help</span></div><div class="line">            DisplayHelp();</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i][1] == <span class="charliteral">&#39;q&#39;</span>) {</div><div class="line">            <span class="comment">// shhhhhhh!</span></div><div class="line">            quiet++;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i][1] == <span class="charliteral">&#39;v&#39;</span>) {</div><div class="line">            allowVirtual = <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i][1] == <span class="charliteral">&#39;B&#39;</span>) {</div><div class="line">            <span class="comment">// baudrate chosen</span></div><div class="line">            <span class="keywordtype">int</span> tmp = Convert::ToInt32(args[i]-&gt;Substring(2));</div><div class="line">            <span class="keywordflow">switch</span> (tmp) {</div><div class="line">                <span class="keywordflow">case</span> 1000: bitrate = <a name="a19"></a><a class="code" href="canlib_8h.html#ac823cae7d94763607a7ca40fcdb5196d">Canlib::canBITRATE_1M</a>;   <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> 500 : bitrate = <a name="a20"></a><a class="code" href="canlib_8h.html#ae72ee3c12379c4817de3b53c7cc6d89c">Canlib::canBITRATE_500K</a>; <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> 250 : bitrate = <a name="a21"></a><a class="code" href="canlib_8h.html#a87f618db13ec4f48610def72cfb40969">Canlib::canBITRATE_250K</a>; <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> 125 : bitrate = <a class="code" href="canlib_8h.html#a29a9aafde6e861b4fffb72ad124aeed1">Canlib::canBITRATE_125K</a>; <span class="keywordflow">break</span>;</div><div class="line">                default  : DisplayHelp();                     <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> {</div><div class="line">            <span class="comment">// channel number to use</span></div><div class="line">            channel = Convert::ToInt32(args[i]-&gt;Substring(1));</div><div class="line">        }</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="keywordtype">int</span> handle = PrepareChannel(channel, bitrate);</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span> ((<a class="code" href="canstat_8h.html#a52b5e5c71832b0bd3c6a5b1fd48583e7">Canlib::canStatus</a>)handle &gt;= <a class="code" href="canstat_8h.html#a52b5e5c71832b0bd3c6a5b1fd48583e7a49743d0d438957118b9c6af2e831b209">Canlib::canStatus::canOK</a>) {</div><div class="line">        <span class="comment">// everything initialized so lets start tracking data</span></div><div class="line">        <span class="keywordflow">if</span> (logToFile) Console::SetOut(filePtr);</div><div class="line"></div><div class="line">        DisplayLeadIn(handle);</div><div class="line"></div><div class="line">        RecordMessages(handle);</div><div class="line"></div><div class="line">        DisplaySummary(handle);</div><div class="line"></div><div class="line">        <span class="comment">// close channel</span></div><div class="line">        <a name="a22"></a><a class="code" href="group___c_a_n.html#ga35478fd54d6e830555c85492c9ab2f80">Canlib::canBusOff</a>(handle);</div><div class="line">        <a class="code" href="group___c_a_n.html#ga56459e39593096dac3a6723493f5e898">Canlib::canClose</a>(handle);</div><div class="line"></div><div class="line">        <span class="comment">// close the log file</span></div><div class="line">        <span class="keywordflow">if</span> (logToFile)  filePtr-&gt;Close();</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Kvaser CANLIB (canlib 5.20) Fri May 5 2017 &#160;
</small></address>
</body>
</html>
